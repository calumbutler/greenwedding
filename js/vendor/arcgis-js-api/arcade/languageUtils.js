// COPYRIGHT © 2016 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.2/esri/copyright.txt for details.

define(["require","exports","../geometry/Geometry","../moment","dojo/number","./ImmutableArray","../kernel","./ImmutablePointArray","./ImmutablePathArray","dojo/_base/array","../geometry/Point","./FunctionWrapper"],function(n,e,r,t,i,u,o,a,f,l,c,d){function s(n,e,r){if(""===e)return n;if(null===e)return n;if(void 0===e)return n;if(e===r)return n;if(e===r)return n;do n=n.replace(e,r);while(-1!==n.indexOf(e));return n}function m(n){return n instanceof K||n instanceof d||n instanceof W}function v(n){return p(n)?!0:x(n)?!0:N(n)?!0:y(n)?!0:null===n?!0:n===e.voidOperation?!0:"number"==typeof n?!0:!1}function g(n,e){return void 0===n?e:n}function p(n){return"string"==typeof n||n instanceof String}function y(n){return"boolean"==typeof n}function x(n){return"number"==typeof n}function h(n){return n instanceof Array}function T(n){return n&&void 0!==n.isFeatureCursor}function O(n){return n instanceof u}function N(n){return n instanceof Date}function b(n,e,r){if(n.length<e||n.length>r)throw new Error("Function called with wrong number of Parameters")}function S(){var n=(new Date).getTime(),e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var r=(n+16*Math.random())%16|0;return n=Math.floor(n/16),("x"===e?r:3&r|8).toString(16)});return e}function I(n,e){return isNaN(n)===!1?void 0===e||null===e||""===e?n.toString():(e=s(e,"‰",""),e=s(e,"¤",""),i.format(n,{pattern:e})):n.toString()}function C(n,e){var r=t(n);return void 0===e||null===e||""===e?r.format():r.format(_(e))}function _(n){var e=n.replace(/(LTS)|L|l/g,function(n){return"["+n+"]"});return e}function D(n,e,r){switch(r){case">":return n>e;case"<":return e>n;case">=":return n>=e;case"<=":return e>=n}return!1}function j(n,r,t){if(null===n){if(null===r||r===e.voidOperation)return D(null,null,t);if(x(r))return D(0,r,t);if(p(r))return D(0,J(r),t);if(y(r))return D(0,J(r),t);if(N(r))return D(0,r.getTime(),t)}if(n===e.voidOperation){if(null===r||r===e.voidOperation)return D(null,null,t);if(x(r))return D(0,r,t);if(p(r))return D(0,J(r),t);if(y(r))return D(0,J(r),t);if(N(r))return D(0,r.getTime(),t)}else if(x(n)){if(x(r))return D(n,r,t);if(y(r))return D(n,J(r),t);if(null===r||r===e.voidOperation)return D(n,0,t);if(p(r))return D(n,J(r),t);if(N(r))return D(n,r.getTime(),t)}else if(p(n)){if(p(r))return D(V(n),V(r),t);if(N(r))return D(J(n),r.getTime(),t);if(x(r))return D(J(n),r,t);if(null===r||r===e.voidOperation)return D(J(n),0,t);if(y(r))return D(J(n),J(r),t)}else if(N(n)){if(N(r))return D(n,r,t);if(null===r||r===e.voidOperation)return D(n.getTime(),0,t);if(x(r))return D(n.getTime(),r,t);if(y(r))return D(n.getTime(),J(r),t);if(p(r))return D(n.getTime(),J(r),t)}else if(y(n)){if(y(r))return D(n,r,t);if(x(r))return D(J(n),J(r),t);if(N(r))return D(J(n),r.getTime(),t);if(null===r||r===e.voidOperation)return D(J(n),0,t);if(p(r))return D(J(n),J(r),t)}return F(n,r)&&("<="===t||">="===t)?!0:!1}function F(n,r){if(n===r)return!0;if(null===n&&r===e.voidOperation||null===r&&n===e.voidOperation)return!0;if(N(n)&&N(r))return n.getTime()===r.getTime();if(n instanceof f)return n.equalityTest(r);if(n instanceof a)return n.equalityTest(r);if(n instanceof c&&r instanceof c){var t=void 0,i=void 0;if(e.isVersion4?(t=n.cache._arcadeCacheId,i=r.cache._arcadeCacheId):(t=n.getCacheValue("_arcadeCacheId"),i=r.getCacheValue("_arcadeCacheId")),void 0!==t&&null!==t)return t===i}if(void 0!==n&&void 0!==r&&null!==n&&null!==r&&"object"==typeof n&&"object"==typeof r){if(n._arcadeCacheId===r._arcadeCacheId&&void 0!==n._arcadeCacheId&&null!==n._arcadeCacheId)return!0;if(n._underlyingGraphic===r._underlyingGraphic&&void 0!==n._underlyingGraphic&&null!==n._underlyingGraphic)return!0}return!1}function V(n,t){if(p(n))return n;if(null===n)return"";if(x(n))return I(n,t);if(y(n))return n.toString();if(N(n))return C(n,t);if(n instanceof r)return JSON.stringify(n.toJSON());if(h(n)){for(var i=[],o=0;o<n.length;o++)i[o]=A(n[o]);return"["+i.join(",")+"]"}if(n instanceof u){for(var i=[],o=0;o<n.length();o++)i[o]=A(n.get(o));return"["+i.join(",")+"]"}return null!==n&&"object"==typeof n&&void 0!==n.castToText?n.castToText():m(n)?"object, Function":(n===e.voidOperation,"")}function R(n){var e=[];if(h(n)===!1)return null;if(n instanceof u){for(var r=0;r<n.length();r++)e[r]=J(n.get(r));return e}for(var r=0;r<n.length;r++)e[r]=J(n[r]);return e}function w(n,t){if(p(n))return n;if(null===n)return"";if(x(n))return I(n,t);if(y(n))return n.toString();if(N(n))return C(n,t);if(n instanceof r)return JSON.stringify(n.toJSON());if(h(n)){for(var i=[],o=0;o<n.length;o++)i[o]=A(n[o]);return"["+i.join(",")+"]"}if(n instanceof u){for(var i=[],o=0;o<n.length();o++)i[o]=A(n.get(o));return"["+i.join(",")+"]"}return null!==n&&"object"==typeof n&&void 0!==n.castToText?n.castToText():m(n)?"object, Function":(n===e.voidOperation,"")}function A(n){if(null===n)return"null";if(y(n)||x(n)||p(n))return JSON.stringify(n);if(n instanceof r)return w(n);if(n instanceof u)return w(n);if(n instanceof Array)return w(n);if(n instanceof Date)return JSON.stringify(C(n,""));if(null!==n&&"object"==typeof n){if(void 0!==n.castToText)return n.castToText()}else if(n===e.voidOperation)return"null";return"null"}function J(n,r){return x(n)?n:null===n?0:""===n?0:N(n)?NaN:y(n)?n?1:0:""===n?NaN:void 0===n?NaN:void 0!==r&&p(n)?(r=s(r,"‰",""),r=s(r,"¤",""),i.parse(n,{pattern:r})):n===e.voidOperation?0:Number(n)}function L(n,e){if(N(n))return n;if(p(n)){var r=t(n,[void 0===e||null===e||""===e?t.ISO_8601:e]);if(r.isValid())return r.toDate()}return null}function G(n,e){if(N(n))return t(n);if(p(n)){var r=t(n,[void 0===e||null===e||""===e?t.ISO_8601:e]);if(r.isValid())return r}return null}function P(n){return y(n)?n:p(n)?(n=n.toLowerCase(),"true"===n?!0:!1):x(n)?0===n?!1:isNaN(n)?!1:!0:!1}function q(n,e){return null===n?null:((null===n.spatialReference||void 0===n.spatialReference)&&(n.spatialReference=e),n)}function E(n,e){if(!n)return null;if(!n.domain)return null;var r=null;e="string"===n.field.type||"esriFieldTypeString"===n.field.type?V(e):J(e);for(var t=0;t<n.domain.codedValues.length;t++){var i=n.domain.codedValues[t];i.code===e&&(r=i)}return null===r?null:r.name}function U(n,e){if(!n)return null;if(!n.domain)return null;var r=null;e=V(e);for(var t=0;t<n.domain.codedValues.length;t++){var i=n.domain.codedValues[t];i.name===e&&(r=i)}return null===r?null:r.code}function k(n,e,r,t){if(void 0===r&&(r=null),!e)return null;if(!e.fields)return null;for(var i=null,u=0;u<e.fields.length;u++){var o=e.fields[u];o.name.toLowerCase()===n.toString().toLowerCase()&&(i=o)}if(null===i)return null;var a,f;return t||(t=r&&e.typeIdField&&r._field(e.typeIdField)),null!=t&&l.some(e.types,function(n){return n.id===t?(a=n.domains&&n.domains[i.name],a&&"inherited"===a.type&&(a=B(i.name,e),f=!0),!0):!1}),f||a||(a=B(n,e)),{field:i,domain:a}}function B(n,e){var r;return l.some(e.fields,function(e){return e.name===n&&(r=e.domain),!!r}),r}var M=function(){function n(n){this.value=n}return n}(),z=function(){function n(n){this.value=n}return n}(),K=function(){function n(n){this.fn=n}return n}(),W=function(){function n(n){this.fn=n}return n}();e.NativeFunction=K,e.ImplicitResult=z,e.ReturnResult=M,e.SizzleFunction=W,e.isVersion4=0===o.version.indexOf("4."),e.voidOperation={type:"VOID"},e.breakResult={type:"BREAK"},e.continueResult={type:"CONTINUE"},e.multiReplace=s,e.isFunctionParameter=m,e.isSimpleType=v,e.defaultUndefined=g,e.isString=p,e.isBoolean=y,e.isNumber=x,e.isArray=h,e.isFeatureCursor=T,e.isImmutableArray=O,e.isDate=N,e.pcCheck=b,e.generateUUID=S,e.formatNumber=I,e.formatDate=C,e.standardiseDateFormat=_,e.greaterThanLessThan=j,e.equalityTest=F,e.toString=V,e.toNumberArray=R,e.toStringExplicit=w,e.toNumber=J,e.toDate=L,e.toDateM=G,e.toBoolean=P,e.fixSpatialReference=q,e.getDomainValue=E,e.getDomainCode=U,e.getDomain=k});