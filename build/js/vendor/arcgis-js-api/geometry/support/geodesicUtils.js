// COPYRIGHT Â© 2016 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.2/esri/copyright.txt for details.

define(["dojo/_base/array","../SpatialReference","../Point","../Polyline","../Polygon"],function(e,a,t,r,s){function i(e){var a=Math.PI/180,r=6378137,s=.006694379990197414,i=.0818191908429643,n=Math.sin(e.y*a),h=(1-s)*(n/(1-s*(n*n))-1/(2*i)*Math.log((1-i*n)/(1+i*n))),o=r*e.x*a,c=r*h*.5,M=new t(o,c);return M}function n(e,r,s,i){for(var n,h,o,c,M=6378137,u=6356752.31424518,f=1/298.257223563,l=Math.sin(s),v=Math.cos(s),g=(1-f)*Math.tan(e),p=1/Math.sqrt(1+g*g),y=g*p,d=Math.atan2(g,v),q=p*l*(p*l),m=1-q,w=m*(M*M-u*u)/(u*u),S=1+w/16384*(4096+w*(-768+w*(320-175*w))),P=w/1024*(256+w*(-128+w*(74-47*w))),x=i/(u*S),D=2*Math.PI;Math.abs(x-D)>1e-12;)o=Math.cos(2*d+x),n=Math.sin(x),h=Math.cos(x),c=P*n*(o+P/4*(h*(-1+2*o*o)-P/6*o*(-3+4*n*n)*(-3+4*o*o))),D=x,x=i/(u*S)+c;var E=y*n-p*h*v,I=Math.atan2(y*h+p*n*v,(1-f)*Math.sqrt(q+E*E)),_=Math.atan2(n*l,p*h-y*n*v),A=f/16*m*(4+f*(4-3*m)),R=_-(1-A)*f*Math.sqrt(q)*(x+A*n*(o+A*h*(-1+2*o*o))),z=I/(Math.PI/180),b=(r+R)/(Math.PI/180),N=new t(b,z,new a({wkid:4326}));return N}function h(e,a,t,r){var s,i,n,h,o,c,M,u,f,l,v=6378137,g=6356752.31424518,p=1/298.257223563,y=r-a,d=Math.atan((1-p)*Math.tan(e)),q=Math.atan((1-p)*Math.tan(t)),m=Math.sin(d),w=Math.cos(d),S=Math.sin(q),P=Math.cos(q),x=y,D=1e3;do{if(M=Math.sin(x),u=Math.cos(x),n=Math.sqrt(P*M*(P*M)+(w*S-m*P*u)*(w*S-m*P*u)),0===n)return 0;o=m*S+w*P*u,c=Math.atan2(n,o),f=w*P*M/n,i=1-f*f,h=o-2*m*S/i,isNaN(h)&&(h=0),l=p/16*i*(4+p*(4-3*i)),s=x,x=y+(1-l)*p*f*(c+l*n*(h+l*o*(-1+2*h*h)))}while(Math.abs(x-s)>1e-12&&--D>0);if(0===D){var E=6371009,I=Math.acos(Math.sin(e)*Math.sin(t)+Math.cos(e)*Math.cos(t)*Math.cos(r-a))*E,_=r-a,A=Math.sin(_)*Math.cos(t),R=Math.cos(e)*Math.sin(t)-Math.sin(e)*Math.cos(t)*Math.cos(_),z=Math.atan2(A,R);return{azimuth:z,geodesicDistance:I}}var b=i*(v*v-g*g)/(g*g),N=1+b/16384*(4096+b*(-768+b*(320-175*b))),C=b/1024*(256+b*(-128+b*(74-47*b))),F=C*n*(h+C/4*(o*(-1+2*h*h)-C/6*h*(-3+4*n*n)*(-3+4*h*h))),G=g*N*(c-F),K=Math.atan2(P*Math.sin(x),w*S-m*P*Math.cos(x)),Y=Math.atan2(w*Math.sin(x),w*S*Math.cos(x)-m*P),j={azimuth:K,geodesicDistance:G,reverseAzimuth:Y};return j}function o(a,t){var i=Math.PI/180,o=6371008.771515059;if(o/1e4>t&&(t=o/1e4),!(a instanceof r||a instanceof s)){var c="_geodesicDensify: the input geometry is neither polyline nor polygon";throw console.error(c),new Error(c)}var M,u=a instanceof r,f=u?a.paths:a.rings,l=[];return e.forEach(f,function(e){l.push(M=[]),M.push([e[0][0],e[0][1]]);var a,r,s,o,c,u;for(a=e[0][0]*i,r=e[0][1]*i,c=0;c<e.length-1;c++)if(s=e[c+1][0]*i,o=e[c+1][1]*i,a!==s||r!==o){var f=h(r,a,o,s),v=f.azimuth,g=f.geodesicDistance,p=g/t;if(p>1){for(u=1;p-1>=u;u++){var y=u*t,d=n(r,a,v,y);M.push([d.x,d.y])}var q=(g+Math.floor(p-1)*t)/2,m=n(r,a,v,q);M.push([m.x,m.y])}var w=n(r,a,v,g);M.push([w.x,w.y]),a=w.x*i,r=w.y*i}}),u?new r({paths:l,spatialReference:a.spatialReference}):new s({rings:l,spatialReference:a.spatialReference})}function c(a,t){var r=Math.PI/180,s=[];return e.forEach(a,function(a,i){var n=0;e.forEach(a.paths,function(e,a){var t,s,i,o,c,M,u=0;for(t=1;t<e.length;t++)s=e[t-1][0]*r,i=e[t][0]*r,o=e[t-1][1]*r,c=e[t][1]*r,(o!==c||s!==i)&&(M=h(o,s,c,i),u+=M.geodesicDistance/1609.344);n+=u}),n*=u[t],s.push(n)}),s}function M(a,r){var s=[];e.forEach(a,function(e,a){var t=o(e,1e4);s.push(t)});var n,h,c=[];return e.forEach(s,function(a,s){var o=0;e.forEach(a.rings,function(e,a){n=i(new t(e[0][0],e[0][1])),h=i(new t(e[e.length-1][0],e[e.length-1][1]));var r,s=h.x*n.y-n.x*h.y;for(r=0;r<e.length-1;r++)n=i(new t(e[r+1][0],e[r+1][1])),h=i(new t(e[r][0],e[r][1])),s+=h.x*n.y-n.x*h.y;s/=4046.87,o+=s}),o*=u[r],c.push(o/-2)}),c}var u={esriMiles:1,esriKilometers:1.609344,esriFeet:5280,esriMeters:1609.34,esriYards:1760,esriNauticalMiles:.869,esriCentimeters:160934,esriDecimeters:16093.4,esriInches:63360,esriMillimeters:1609340,esriAcres:1,esriAres:40.4685642,esriSquareKilometers:.00404685642,esriSquareMiles:.0015625,esriSquareFeet:43560,esriSquareMeters:4046.85642,esriHectares:.404685642,esriSquareYards:4840,esriSquareInches:6272640,esriSquareMillimeters:4046856420,esriSquareCentimeters:40468564.2,esriSquareDecimeters:404685.642},f={geodesicDensify:o,geodesicLengths:c,geodesicAreas:M,_unitsDictionary:u,_toEqualAreaPoint:i,_directGeodeticSolver:n,_inverseGeodeticSolver:h};return f});