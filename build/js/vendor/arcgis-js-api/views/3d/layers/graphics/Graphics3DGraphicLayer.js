// COPYRIGHT Â© 2016 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.2/esri/copyright.txt for details.

define(["require","exports","../../../../core/tsSupport/extendsHelper","./ElevationInfo","../../webgl-engine/Stage","../../lib/glMatrix","../../support/aaBoundingBox"],function(t,e,i,s,n,r,o){function a(t,e,i){return i||(i=o.create()),o.setMin(i,t.getBBMin(e)),o.setMax(i,t.getBBMax(e)),i}var u=r.vec3d,h=r.mat4d,l=function(){function t(e,i,s,n,r,o,a,u){this._addedToStage=!1,this.graphics3DSymbolLayer=e,this.uniqueMaterials=n,this.uniqueGeometries=s,this.uniqueTextures=r,this.stageObject=i,this.elevationAligner=o,this.elevationInfo=new c(a),this.stage=null,this.stageLayer=null,this._shown=!1,this._visibilityFlags={},this.visibilityMode=null!=u?u:t.VisibilityModes.HIDE_FACERANGE}return t.prototype.initialize=function(t,e){if(this.stageLayer=t,this.stage=e,this.uniqueMaterials)for(var i=0;i<this.uniqueMaterials.length;i++)e.add(n.ModelContentType.MATERIAL,this.uniqueMaterials[i]);if(this.uniqueGeometries)for(var i=0;i<this.uniqueGeometries.length;i++)e.add(n.ModelContentType.GEOMETRY,this.uniqueGeometries[i]);if(this.uniqueTextures)for(var i=0;i<this.uniqueTextures.length;i++)e.add(n.ModelContentType.TEXTURE,this.uniqueTextures[i]);e.add(n.ModelContentType.OBJECT,this.stageObject)},t.prototype.isDraped=function(){return!1},t.prototype.areVisibilityFlagsSet=function(t,e){for(var i=!0,s=Object.keys(this._visibilityFlags),n=0;n<s.length;n++){var r=s[n];if(r!==e){if(r===t)return this._visibilityFlags[r];i=i&&this._visibilityFlags[r]}}return i},t.prototype.setVisibilityFlag=function(t,e){return this._visibilityFlags[t]=e,this._calcAndSetVisibility()},t.prototype._calcAndSetVisibility=function(){if(null!=this.stage){var e=this.areVisibilityFlagsSet();return this._shown!==e?(this._shown=e,this._shown?this._addedToStage?this.stageObject.unhideAllFaceRange():(this.stageLayer.addObject(this.stageObject),this._addedToStage=!0):this.visibilityMode===t.VisibilityModes.HIDE_FACERANGE?this.stageObject.hideAllFaceRanges():(this.stageLayer.removeObject(this.stageObject),this._addedToStage=!1),!0):!1}},t.prototype.destroy=function(){var t=this.stage;if(this.stageLayer){if(this.uniqueMaterials)for(var e=0;e<this.uniqueMaterials.length;e++)t.remove(n.ModelContentType.MATERIAL,this.uniqueMaterials[e].getId());if(this.uniqueGeometries)for(var e=0;e<this.uniqueGeometries.length;e++)t.remove(n.ModelContentType.GEOMETRY,this.uniqueGeometries[e].getId());if(this.uniqueTextures)for(var e=0;e<this.uniqueTextures.length;e++)t.remove(n.ModelContentType.TEXTURE,this.uniqueTextures[e].getId())}t.remove(n.ModelContentType.OBJECT,this.stageObject.getId()),this._addedToStage&&(this.stageLayer.removeObject(this.stageObject),this._addedToStage=!1),this._shown=!1,this.stageLayer=null,this.stage=null},t.prototype.mustAlignToTerrain=function(){return null!==this.elevationAligner},t.prototype.alignWithElevation=function(t,e){this.elevationAligner&&this.elevationAligner(this,t,e)},t.prototype.setDrawOrder=function(t,e,i){},t.prototype.getBSRadius=function(){return this.stageObject.getBSRadius()},t.prototype.getCenterObjectSpace=function(){return this.stageObject.getCenter(!0)},t.prototype.getBoundingBoxObjectSpace=function(t){return a(this.stageObject,!0,t)},t.prototype.getProjectedBoundingBox=function(t,e){for(var i=this.getBoundingBoxObjectSpace(e),s=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],n=0;n<s.length;n++){var r=s[n];d[0]=i[r[0]],d[1]=i[r[1]],d[2]=i[r[2]],h.multiplyVec3(this.stageObject.objectTransformation,d),g[3*n+0]=d[0],g[3*n+1]=d[1],g[3*n+2]=d[2]}if(t(g,0,8)){o.set(i,o.NEGATIVE_INFINITY);for(var n=0;n<g.length;n+=3)for(var a=0;3>a;a++)i[a]=Math.min(i[a],g[n+a]),i[a+3]=Math.max(i[a+3],g[n+a]);return i}return null},t.prototype.getScreenSize=function(){throw new Error("Not implemented for this symbol layer/graphic type")},t.VisibilityModes={REMOVE_OBJECT:0,HIDE_FACERANGE:1},t}(),g=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],d=u.create(),c=function(t){function e(e){t.call(this,e),this.centerPointInElevationSR=null}return i(e,t),e}(s);return l});