// COPYRIGHT Â© 2016 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.2/esri/copyright.txt for details.

define(["../../core/Accessor","../../core/HandleRegistry","../../core/watchUtils","./Component","dojo/_base/lang","dojo/dom-class","dojo/dom-construct","dojo/dom-style"],function(t,n,i,e,o,r,a,s){function c(t){return t&&!t._started&&"function"==typeof t.postMixInProperties&&"function"==typeof t.buildRendering&&"function"==typeof t.postCreate&&"function"==typeof t.startup}var d={left:0,top:0,bottom:0,right:0},h={bottom:30,top:15,right:15,left:15},u="manual",p={ui:"esri-ui",corner:"esri-ui-corner",innerContainer:"esri-ui-inner-container",manualContainer:"esri-ui-manual-container",cornerContainer:"esri-ui-corner-container",topLeft:"esri-ui-top-left",topRight:"esri-ui-top-right",bottomLeft:"esri-ui-bottom-left",bottomRight:"esri-ui-bottom-right"};return t.createSubclass({properties:{container:{},height:{readOnly:!0,dependsOn:["view.height"]},padding:{},view:{},width:{readOnly:!0,dependsOn:["view.width"]}},declaredClass:"esri.views.ui.UI",constructor:function(){this._components=[],this._handles=new n,this._initContainers()},getDefaults:function(){return o.mixin(this.inherited(arguments),{padding:h})},initialize:function(){this._handles.add(i.init(this,"view.padding, container",this._applyViewPadding.bind(this)),i.init(this,"padding",this._applyUIPadding.bind(this)))},destroy:function(){this.container=null,this._components.forEach(function(t){t.destroy()}),this._components.length=0,this._handles.destroy()},_cornerNameToContainerLookup:null,_positionNameToContainerLookup:null,_components:null,_handles:null,container:null,_containerSetter:function(t){var n=this._get("container");t!==n&&(t&&(r.add(t,p.ui),this._attachContainers(t)),n&&(r.remove(n,p.ui),s.set(n,{top:"",bottom:"",left:"",right:""}),a.empty(n)),this._set("container",t))},_heightGetter:function(){var t=this.get("view.height")||0;if(0===t)return t;var n=this._getViewPadding(),i=n.top+n.bottom;return Math.max(t-i,0)},_paddingSetter:function(t){"number"==typeof t?this._set("padding",{bottom:t,top:t,right:t,left:t}):this._set("padding",o.mixin({},h,t))},view:null,_widthGetter:function(){var t=this.get("view.width")||0;if(0===t)return t;var n=this._getViewPadding(),i=n.left+n.right;return Math.max(t-i,0)},add:function(t,n){var i;if(Array.isArray(t))return void t.forEach(function(t){this.add(t,n)},this);if(n&&"object"==typeof n&&(i=n.index,n=n.position),t&&(!n||this._isValidPosition(n))){if(!t.isInstanceOf||!t.isInstanceOf(e)){var o="object"==typeof t&&"domNode"in t&&!t.domNode&&!c(t.widget);o&&(t.domNode=a.create("div")),t=new e({node:t})}this._place({component:t,position:n,index:i}),this._components.push(t)}},remove:function(t){if(t){if(Array.isArray(t))return t.map(this.remove,this);var n=this.find(t);if(n){var i=this._components.indexOf(n);return n.node.parentNode&&n.node.parentNode.removeChild(n.node),this._components.splice(i,1)[0]}}},empty:function(t){return Array.isArray(t)?t.map(function(t){return this.empty(t).reduce(function(t,n){return t.concat(n)})},this):(t=t||u,t===u?Array.prototype.slice.call(this._manualContainer.children).filter(function(t){return!r.contains(t,p.corner)},this).map(this.remove,this):this._isValidPosition(t)?Array.prototype.slice.call(this._cornerNameToContainerLookup[t].children).map(this.remove,this):void 0)},move:function(t,n){if(!n||this._isValidPosition(n)){var i=this.remove(t);i&&this.add(i,n)}},find:function(t){return t?t.isInstanceOf&&t.isInstanceOf(e)?this._findByComponent(t):"string"==typeof t?this._findById(t):this._findByNode(t.domNode||t):null},_getViewPadding:function(){return this.get("view.padding")||d},_attachContainers:function(t){a.place(this._manualContainer,t),a.place(this._innerContainer,t)},_initContainers:function(){var t,n,i,e,r=a.create("div",{className:p.innerContainer+" "+p.cornerContainer}),s=a.create("div",{className:p.innerContainer+" "+p.manualContainer});t=a.create("div",{className:p.topLeft+" "+p.corner},r),n=a.create("div",{className:p.topRight+" "+p.corner},r),i=a.create("div",{className:p.bottomLeft+" "+p.corner},r),e=a.create("div",{className:p.bottomRight+" "+p.corner},r),this._innerContainer=r,this._manualContainer=s,this._cornerNameToContainerLookup={"top-left":t,"top-right":n,"bottom-left":i,"bottom-right":e},this._positionNameToContainerLookup=o.mixin({manual:s},this._cornerNameToContainerLookup)},_isValidPosition:function(t){return!!this._positionNameToContainerLookup[t]},_place:function(t){var n,i,e,o=t.component,r=t.position||u,a=t.index,s=this._positionNameToContainerLookup[r],c=a>-1;return c?(n=s.children,(i=0===a)?void this._placeComponent(o,s,"first"):(e=a>=n.length)?void this._placeComponent(o,s,"last"):void this._placeComponent(o,n[a],"before")):void this._placeComponent(o,s,"last")},_placeComponent:function(t,n,i){c(t.widget)&&t.widget.startup(),a.place(t.node,n,i)},_applyViewPadding:function(){var t=this.container;t&&s.set(t,this._toPxPosition(this._getViewPadding()))},_applyUIPadding:function(){var t=this._innerContainer;t&&s.set(this._innerContainer,this._toPxPosition(this.padding))},_toPxPosition:function(t){return{top:this._toPxUnit(t.top),left:this._toPxUnit(t.left),right:this._toPxUnit(t.right),bottom:this._toPxUnit(t.bottom)}},_toPxUnit:function(t){return 0===t?0:t+"px"},_findByComponent:function(t){var n,i=null;return this._components.some(function(e){return n=e===t,n&&(i=e),n}),i},_findById:function(t){var n,i=null;return this._components.some(function(e){return n=e.id===t,n&&(i=e),n}),i},_findByNode:function(t){var n,i=null;return this._components.some(function(e){return n=e.node===t,n&&(i=e),n}),i}})});