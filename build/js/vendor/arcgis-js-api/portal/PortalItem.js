// COPYRIGHT Â© 2016 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.2/esri/copyright.txt for details.

/**
             * Information on the source of the item and its copyright status.
             *
             * @type {string}
             */

//  licenseInfo

/**
             * Information on license or restrictions related to the item.
             *
             * @type {string}
             */

define(["require","exports","../core/tsSupport/declareExtendsHelper","../core/tsSupport/decorateHelper","../core/accessorSupport/decorators","../core/Error","../core/lang","../geometry/Extent","../core/JSONSupport","../core/Loadable","./Portal","./PortalRating","../core/promiseUtils"],function(e,t,r,o,i,n,a,p,l,s,c,d,u){function y(){return l}var m=function(t){function l(e){t.call(this),this.access=null,this.accessInformation=null,this.avgRating=null,this.created=null,this.culture=null,this.description=null,this.extent=null,this.id=null,this.itemControl=null,this.licenseInfo=null,this.modified=null,this.name=null,this.numComments=null,this.numRatings=null,this.numViews=null,this.owner=null,this.portal=null,this.size=null,this.snippet=null,this.tags=null,this.title=null,this.type=null,this.typeKeywords=null,this.url=null}return r(l,t),Object.defineProperty(l.prototype,"displayName",{get:function(){var e=this.type,t=this.typeKeywords||[],r=e;return"Feature Service"===e||"Feature Collection"===e?r=t.indexOf("Table")>-1?"Table":t.indexOf("Route Layer")>-1?"Route Layer":"Feature Layer":"Image Service"===e?r=t.indexOf("Elevation 3D Layer")>-1?"Elevation Layer":"Imagery Layer":"Scene Service"===e?r="Scene Layer":"Scene Package"===e?r="Scene Layer Package":"Stream Service"===e?r="Feature Layer":"Geoprocessing Service"===e&&this.portal&&this.portal.isPortal?r=t.indexOf("Web Tool")>-1?"Tool":"Geoprocessing Service":"Geocoding Service"===e?r="Locator":"Microsoft Powerpoint"===e?r="Microsoft PowerPoint":"GeoJson"===e?r="GeoJSON":"Globe Service"===e?r="Globe Layer":"Vector Tile Service"===e?r="Tile Layer":"Map Service"===e?r=t.indexOf("Hosted Service")>-1||t.indexOf("Tiled")>-1?"Tile Layer":"Map Image Layer":e&&e.toLowerCase().indexOf("add in")>-1?r=e.replace(/(add in)/gi,"Add-In"):"datastore catalog service"===e&&(r="Big Data File Share"),r},enumerable:!0,configurable:!0}),l.prototype.readExtent=function(e){return e&&e.length?new p(e[0][0],e[0][1],e[1][0],e[1][1]):null},Object.defineProperty(l.prototype,"iconUrl",{get:function(){var t,r=this.type&&this.type.toLowerCase()||"",o=this.typeKeywords||[],i="../images/portal/",n="16",a=!1,p=!1,l=!1;return r.indexOf("service")>0||"feature collection"===r||"kml"===r||"wms"===r||"wmts"===r||"wfs"===r?(a=o.indexOf("Hosted Service")>-1,"feature service"===r||"feature collection"===r||"kml"===r||"wfs"===r?(p=o.indexOf("Table")>-1,l=o.indexOf("Route Layer")>-1,t=p?"table":l?"routelayer":a?"featureshosted":"features"):t="map service"===r||"wms"===r||"wmts"===r?a||o.indexOf("Tiled")>-1||"wmts"===r?"maptiles":"mapimages":"scene service"===r?o.indexOf("Line")>-1?"sceneweblayerline":o.indexOf("3DObject")>-1?"sceneweblayermultipatch":o.indexOf("Point")>-1?"sceneweblayerpoint":o.indexOf("IntegratedMesh")>-1?"sceneweblayermesh":o.indexOf("PointCloud")>-1?"sceneweblayerpointcloud":o.indexOf("Polygon")>-1?"sceneweblayerpolygon":"sceneweblayer":"image service"===r?o.indexOf("Elevation 3D Layer")>-1?"elevationlayer":"imagery":"stream service"===r?"streamlayer":"vector tile service"===r?"vectortile":"datastore catalog service"===r?"datastorecollection":"geocoding service"===r?"geocodeservice":"layers"):t="web map"===r||"cityengine web scene"===r?"maps":"web scene"===r?o.indexOf("ViewingMode-Local")>-1?"webscenelocal":"websceneglobal":"web mapping application"===r||"mobile application"===r||"application"===r||"operation view"===r||"desktop application"===r?"apps":"map document"===r||"map package"===r||"published map"===r||"scene document"===r||"globe document"===r||"basemap package"===r||"mobile basemap package"===r||"mobile map package"===r||"project package"===r||"project template"===r||"pro map"===r||"layout"===r||"layer"===r&&o.indexOf("ArcGIS Pro")>-1||"explorer map"===r&&o.indexOf("Explorer Document")?"mapsgray":"service definition"===r||"csv"===r||"shapefile"===r||"cad drawing"===r||"geojson"===r||"360 vr experience"===r?"datafiles":"explorer add in"===r||"desktop add in"===r||"windows viewer add in"===r||"windows viewer configuration"===r?"appsgray":"arcgis pro add in"===r||"arcgis pro configuration"===r?"addindesktop":"rule package"===r||"file geodatabase"===r||"csv collection"===r||"kml collection"===r||"windows mobile package"===r||"map template"===r||"desktop application template"===r||"arcpad package"===r||"code sample"===r||"form"===r||"document link"===r||"vector tile package"===r||"operations dashboard add in"===r||"rules package"===r||"image"===r||"workflow manager package"===r||"desktop style"===r||"explorer map"===r&&o.indexOf("Explorer Mapping Application")>-1||o.indexOf("Document")>-1?"datafilesgray":"network analysis service"===r||"geoprocessing service"===r||"geodata service"===r||"geometry service"===r||"geoprocessing package"===r||"locator package"===r||"geoprocessing sample"===r||"workflow manager service"===r||"raster function template"===r?"toolsgray":"layer"===r||"layer package"===r||"explorer layer"===r?"layersgray":"scene package"===r?"scenepackage":"tile package"===r?"tilepackage":"task file"===r?"taskfile":"report template"===r?"report-template":"statistical data collection"===r?"statisticaldatacollection":"insights workbook"===r?"workbook":"insights model"===r?"insightsmodel":"insights page"===r?"insightspage":"relational database connection"===r?"relationaldatabaseconnection":"big data file share"===r?"datastorecollection":"image collection"===r?"imagecollection":"style"===r?"style":"maps",t?e.toUrl(i+t+n+".png"):null},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"isLayer",{get:function(){var e=["Map Service","Feature Service","Feature Collection","Scene Service","Image Service","Stream Service","Vector Tile Service"];return e.indexOf(this.type)>-1},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"itemUrl",{get:function(){var e=this.get("portal.restUrl");return e?e+"/content/items/"+this.id:null},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"thumbnailUrl",{get:function(){var e=this.itemUrl,t=this.thumbnail;return e&&t?this.portal._normalizeUrl(e+"/info/"+t):null},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"userItemUrl",{get:function(){var e=this.get("portal.restUrl");if(!e)return null;var t=this.owner||this.get("portal.user.username");if(!t)return null;var r=this.ownerFolder?t+"/"+this.ownerFolder:t;return e+"/content/users/"+r+"/items/"+this.id},enumerable:!0,configurable:!0}),l.prototype.load=function(){var e=this;this.portal||(this.portal=c.getDefault());var t=this.portal.load().then(function(){return e.resourceInfo?e.resourceInfo:e.id&&e.itemUrl?e.portal._request(e.itemUrl):{}}).then(function(t){e.resourceInfo=t,e.read(t)});return this.addResolvingPromise(t),this},l.prototype.addRating=function(e){var t={method:"post",query:{}};return e instanceof d&&(e=e.rating),isNaN(e)||"number"!=typeof e||(t.query.rating=e),this.portal._request(this.itemUrl+"/addRating",t).then(function(){return new d({rating:e,created:new Date})})},l.prototype.deleteRating=function(){return this.portal._request(this.itemUrl+"/deleteRating",{method:"post"}).then(function(){})},l.prototype.fetchData=function(e){return void 0===e&&(e="json"),this.portal._request(this.itemUrl+"/data",{responseType:e})},l.prototype.fetchRating=function(){return this.portal._request(this.itemUrl+"/rating").then(function(e){return null!=e.rating?(e.created=new Date(e.created),new d(e)):null})},l.prototype.fetchRelatedItems=function(e){return this.portal._requestToTypedArray(this.itemUrl+"/relatedItems",{query:e},"PortalItem")},l.prototype.update=function(e){var t=this;if(!this.id)return u.reject(new n("portal:item-does-not-exist","The item does not exist yet and cannot be updated"));var r=e&&e.data,o={method:"post"};o.query=this._getPostQuery();for(var i in o.query)null===o.query[i]&&(o.query[i]="");o.query.clearEmptyFields=!0,null!=r&&("string"==typeof r?o.query.text=r:"object"==typeof r&&(o.query.text=JSON.stringify(r)));var a=this.userItemUrl;return a?this.portal._request(a+"/update",o).then(function(){return t.loaded?t._reload():t.load()}):u.reject(new n("portal:not-signed-in","Not signed in"))},l.prototype.toJSON=function(){var e=this.extent,t={created:this.created&&this.created.getTime(),description:this.description,extent:e&&[[e.xmin,e.ymin],[e.xmax,e.ymax]],id:this.id,modified:this.modified&&this.modified.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,tags:this.tags,thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:this.typeKeywords,url:this.url};return a.fixJson(t)},l.fromJSON=function(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");return new l({resourceInfo:e})},l.prototype._reload=function(){var e=this;return this.portal._request(this.itemUrl,{query:{_ts:(new Date).getTime()}}).then(function(t){return e.resourceInfo=t,e.read(t),e})},l.prototype._getPostQuery=function(){var e=this.toJSON();for(var t in e)"tags"===t&&null!==e[t]&&(e[t]=e[t].join(", ")),"typeKeywords"===t&&null!==e[t]&&(e[t]=e[t].join(", "));return e},o([i.property()],l.prototype,"access",void 0),o([i.property()],l.prototype,"accessInformation",void 0),o([i.property()],l.prototype,"avgRating",void 0),o([i.property({type:Date})],l.prototype,"created",void 0),o([i.property()],l.prototype,"culture",void 0),o([i.property()],l.prototype,"description",void 0),o([i.property({dependsOn:["type","typeKeywords"],readOnly:!0})],l.prototype,"displayName",null),o([i.property({type:p})],l.prototype,"extent",void 0),o([i.read("extent")],l.prototype,"readExtent",null),o([i.property({dependsOn:["type","typeKeywords"],readOnly:!0})],l.prototype,"iconUrl",null),o([i.property()],l.prototype,"id",void 0),o([i.property({dependsOn:["type"],readOnly:!0})],l.prototype,"isLayer",null),o([i.property()],l.prototype,"itemControl",void 0),o([i.property({dependsOn:["portal.restUrl","id"],readOnly:!0})],l.prototype,"itemUrl",null),o([i.property()],l.prototype,"licenseInfo",void 0),o([i.property({type:Date})],l.prototype,"modified",void 0),o([i.property()],l.prototype,"name",void 0),o([i.property()],l.prototype,"numComments",void 0),o([i.property()],l.prototype,"numRatings",void 0),o([i.property()],l.prototype,"numViews",void 0),o([i.property()],l.prototype,"owner",void 0),o([i.property()],l.prototype,"ownerFolder",void 0),o([i.property({type:c})],l.prototype,"portal",void 0),o([i.property()],l.prototype,"resourceInfo",void 0),o([i.property()],l.prototype,"size",void 0),o([i.property()],l.prototype,"snippet",void 0),o([i.property()],l.prototype,"tags",void 0),o([i.property()],l.prototype,"thumbnail",void 0),o([i.property({dependsOn:["itemUrl","thumbnail","portal.credential.token"],readOnly:!0})],l.prototype,"thumbnailUrl",null),o([i.property()],l.prototype,"title",void 0),o([i.property()],l.prototype,"type",void 0),o([i.property()],l.prototype,"typeKeywords",void 0),o([i.property()],l.prototype,"url",void 0),o([i.property({dependsOn:["portal.restUrl","portal.user.username","owner","ownerFolder","id"],readOnly:!0})],l.prototype,"userItemUrl",null),l=o([i.subclass("esri.portal.PortalItem")],l)}(i.declared(y(),s));return m});